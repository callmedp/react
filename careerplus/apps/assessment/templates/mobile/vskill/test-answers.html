{% extends "mobile/basic/base.html" %}
{% load static compress %}
{% load static thumbnail compress %}
{% block title %}Shine learning{% endblock %}
{% block css_section %}
{{ block.super }}
{% compress css %}
<link type="text/scss" href="{% static 'shinelearn/css/mobile/vskill/practice_tests.scss' %}" rel="stylesheet">
<link type="text/scss" href="{% static 'shinelearn/css/mobile/common/slick.scss' %}" rel="stylesheet">
<link type="text/css" href="{% static 'shinelearn/css/common/mobile/typeaheadjs.css' %}" rel="stylesheet">
{% endcompress %}
{% endblock css_section %}
{% block canonical_url %}
<link rel="canonical" href="//{{ SITE_DOMAIN }}/">
{% endblock canonical_url %}
{% block django_meta %}
{% include 'meta/meta.html' %}
{% endblock django_meta %}
{% block header %}
{% endblock header %}

{% block container %}
<div class="body-wrapper practice-test ">
    <div class="practice-test-inside"></div>
    <div class="menu-blue" id="sidebar-main-trigger"></div>

    <h1>Your Test Result</h1>
    <div class="bread-crums">
        {% for bread in breadcrumbs %}
                  {% if bread.url %}
            <a href='{{bread.url}}'>{{bread.name}} </a>-

            {% else %}
          <a href="#">{{bread.name}}</a>
            {% endif %}

        {% endfor %}
    </div>


    <div class="test-result">
        <span class="text-center mt-10">
            <img id="resultImage" src="">
        </span>
        <h2 id="resultRemark"></h2>

        <div class="test-result__you-scored mt-15">
            <p class="test-result__you-scored--text">You scored</p>
            <p class="test-result__you-scored--percentage"><strong id="scoringPercent"></strong>%</p>
            <a href="#answers" class="btn btn-blue btn-lg2 btn-round-30" id="btn-checkAnswers">Check answers</a>
            <p class="mt-15 fs-16 pb-0 mb-30"><strong id="correctMsg"> </strong></p>
            <p id="resultCourse"></p>
        </div>

        <div class="test-result--time-taken">
            <span>Time taken:</span>
            <span id="timeTaken"></span>
        </div>
    </div><!-- Your Test Result -->

    <div class="test-answers" id="answers">
        <h2>Test Answers</h2>
        <ol>
               {% for quest in questions_list %}
            <li>
                {{quest.question_text}}
                <ul>
                    {% for ans in quest.options %}
                    <li>
                        <span id="check{{ans.option_id}}" class=""></span>
                        <input type="radio" id="{{ans.option_id}}" disabled  name="radio{{ans.option_id}}">
                        <label for="{{ans.option_id}}">{{ans.option}}</label>
                    </li>
                    {% endfor %}
                </ul>
            </li>
                                {% endfor %}
            
        </ol>
    </div><!-- /. Test Answers -->

    <div class="mt-30 mb-30">
        <div class="d-flex justify-content-between align-items-start">
            <button class="btn btn-round-30 btn-blue w-50" onclick="reTestFunc();">Re Test</button>
            <div class="btn btn-round-30 btn-blue w-50 mb-15" onclick="showTest('{{object.vendor.id}}','{{object.category.id}}');" id="btn_next-test">Next test</div>
        </div>
        
        <div class="btn btn-round-30 btn-outline w-100" ><a href="/practice-tests/{{object.category.slug}}/sub">Explore other test</a></div>
    </div>

    <div class="feature-test" id="test-product" style="{% if not object.product %} display:none {% endif %};">
            <h2 ><a href="{{object.product.get_absolute_url}}" id="test-product-name">{{object.product.name}}</a></h2>
            <div class="feature-test--price">
                <strong id="test-price">{{object.product.inr_price}}</strong>
                <span class="stirke-through">Rs. 999</span>
            </div>
    
            <div class="feature-test__benefits">
                <p>Benefits</p>
                <ul class="blue-bullet">
                    <li><span></span>500+ questions</li>
                    <li><span></span>Real exam & Practice environment
                    </li>
                    <li><span></span>Answers & Detailed Explanations</li>
                </ul>
    
                <div class="feature-test__btn-wrap">
                    <button class="btn btn-round-30 btn-yellow w-50" onclick="updateToCart('{{object.product.id}}')" >Add to cart</button>
                </div>
    
            </div>
        </div><!-- /. feature-test -->
    
        <div class="improve-skills" id="testCourse" style="{% if not object.course %} display:none {% endif %};">
            <h2>Improve your skills with this course</h2>
            <div class="media-flex">
                <span class="media-flex--img">
                    <img id="courseImg" src="{% if object.course.image %} {{object.course.image.url}} {% endif %}" class="img-responsive" alt="...">
                </span>
                <div class="media-flex--body">
                    <p class="fs-16 semi-bold"><a href="{{object.course.get_absolute_url}}" id="courseName">{{object.course.name}}</a></p>
                    <ul>
                        <li class="mb-10"><strong class="mr-10" id="courseBought">{{object.course.buy_count}}</strong>people bought</li>
                        <li><strong class="mr-10" id="courseJobsAvailable">{{object.course.num_jobs}}</strong>job available</li>
                    </ul>
                </div>
            </div>
        </div><!-- /. Improve your skills with this course -->
</div><!-- Practice test -->


<div class="modal" id="testLimit" style="display:none">
    <span class="close-big" id="close">+</span>
    <div class="modal-content">
       <div class="view-test">
           <span class="overlay"></span>
           <div class="view-test__content">
            <h2>Oops!  Your free test limit for this skill has been exhausted.</h2>
            <h3>Continue your learning, with our paid practice tests</h3>
           </div>
        <img src="{% static 'shinelearn/images/mobile/practice_test/view-test.png' %}" class="img-responsive"/>
       </div>

       <div class="view-test--benefits">
           <p><strong>Benefits</strong></p>
           <ul class="blue-bullet">
                <li><span></span>500+ questions</li>
                <li><span></span>Real exam & Practice environment
                </li>
                <li><span></span>Answers & Detailed Explanations</li>
            </ul>

            <a class="btn btn-round-30 btn-blue btn-lg mt-20" id="viewPaidTest" href="{{object.product.get_absolute_url}}">View test</a>
       </div>
    </div>
</div><!-- /. modal -->

<div class="practice-test check-result-wrap" id="check_results">
    <div class="practice-test-inside"></div>
    <h1>Check result</h1>
    <form class="check-result mt-15"method="post" id="leadCreationForm" >
          {% csrf_token %}
        <p class="fs-18">Enter your details to check the Test result</p>
        <ul class="mt-10">
            <li class="check-result__item input-effect">
                <span class="error-message"></span>
                <input type="text" class="form-control" name="name" id="name" aria-describedby="name" placeholder=" " value = "{{request.session.name}}">
                <label for="name">Name</label>
            </li>
            <li class="check-result__item input-effect">
                <span class="error-message"></span>
                <input type="email" class="form-control" id="email" name="email" value="{{request.session.email}}" aria-describedby="email" placeholder=" ">
                <label for="email">Email</label>
            </li>
            <li class="check-result__item input-effect">
                <span class="error-message"></span>
                <input type="tel" class="form-control" id="mobile" name="number" value="{{request.session.mobile_no}}"  aria-describedby="mobile" placeholder=" ">
                <label for="mobile">Mobile</label>
            </li>
                 <input type="hidden" class="form-control" id="campaign" name="campaign" value="testprep" />
                  <input type="hidden" class="form-control" id="lsource" name="lsource" value="1" />
                 <input type="hidden" class="form-control" id="prd" name="prd" value="{{object.product.name}}" />

            <li class="mt-40 mb-20">
                <button class="btn btn-round-30 btn-blue w-100" type="submit" id="leadCreationSubmit">Submit</button>
            </li>
        </ul>
    </form><!-- Check Result -->
</div>

{% endblock container %}

{% block js_section %}
{{block.super}}
<script src="{% static 'shinelearn/js/assessment/take_test.js' %}"></script>

<script>
var tKey = 'Test-' + '{{object.id}}',myStorage = window.localStorage,
right=0,questionAttempt = null,total = {{questions_list.count}};

$(document).ready(function() {
    {% if not request.session.is_lead_created %}
        {% if request.session.candidate_id %}
            $('#leadCreationSubmit').click();
        {% else %}
            $("#check_results").addClass('open');
        {% endif %}
     {% else %}
        getCoptions();
        {% endif %}


               $.validator.addMethod("customemail",function(value, element) {
            if($.trim(value)!= ''){
                var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                return regex.test(value);
            }
            return true;
    });

$('#leadCreationForm').validate({
  rules: {
            name: {
                maxlength: 80,
            },
            number: {
                required: true,
                number: true,
                minlength: 10,
                maxlength: 10,
            },
            email: {
                required: true,
                email:true,
                customemail:true,
            }
        },
      highlight: function(element, errorClass) {
            element.parentElement.className+=' error';
        },
        unhighlight: function(element, errorClass) {
         element.parentElement.classList.remove('error')
            $(element).siblings('.error-message').html('');
        },
        errorPlacement: function(error, element) {
        $(element).siblings('.error-message').html(error.text());

},

});


});



function getCoptions(){
        questionAttempt = JSON.parse(myStorage.getItem(tKey));
        if (questionAttempt != null) {
            for (var id in Object.keys(questionAttempt)) {
      if (Object.values(questionAttempt)[id] != "" && Object.keys(questionAttempt)[id] != "skippedQuestion") {
                    $('#' + Object.values(questionAttempt)[id]).attr('checked',true);
                }
            }
         }
 $.ajax({
         url   : '/api/v1/question/?test_id={{object.id}}',
         type  : 'get',
         success: function(response){
         for(i of response){
            $('#check'+i.question_options[0]).addClass('pt-sprite icon-right');
            if(questionAttempt && Object.values(questionAttempt) && Object.values(questionAttempt).includes(i.question_options[0])){
                  right+= 1 ;
                     }
                            }
                               if(questionAttempt){
                              for (i of Object.values(questionAttempt)){
                if(! $("#check"+i).hasClass('icon-right')){
                $("#check"+i).addClass('pt-sprite icon-cross');
                }


            }
            }

              $('#correctMsg').text( right+ ' out of '+total+' correct answers ');
                   let scorePercent = (right/total)*100 ;
              let scoreMessage = "";
              $('#scoringPercent').text((right/total)*100 );
              if(scorePercent >80){
              scoreMessage =  ` Wow! </br>Awesome Score`;
               $('#resultImage').attr("src","{% static 'shinelearn/images/mobile/practice_test/cup.png' %}");
               $('#resultCourse').html('Take <a href= "{{object.course.get_absolute_url}}">{{object.course.name}} </a> to show off your skills to the recruiter');

              }
               else if(scorePercent <= 80 && scorePercent >=50){
              scoreMessage =  `  Don’t worry! </br> You are almost there`;
              $('#resultImage').attr("src","{% static 'shinelearn/images/mobile/practice_test/dont-worry.png' %}");
              $('#resultCourse').html('Take our paid <a href= "{{object.product.get_absolute_url}}">{{object.product.name}} </a> to do better');

              }
               else{
              $('#resultCourse').html('Take our paid <a href= "{{object.product.get_absolute_url}}">{{object.product.name}}</a> to do better');

              scoreMessage =  ` Don’t panic! </br> We ‘ve got you covered`;
                $('#resultImage').attr("src","{% static 'shinelearn/images/mobile/practice_test/dont-panic.png' %}");

              }
              $('#resultRemark').html(scoreMessage);

                if(questionAttempt && questionAttempt['testTime'+{{object.id}}]){
              $('#timeTaken').text(secondsToMinutes(questionAttempt['testTime'+{{object.id}}]));
              }else{
               $('#timeTaken').text(secondsToMinutes({{object.duration}}));
              }
                                    }
    });



}

function showTest(vid,cid){
    $('#testLimit').show();
    $('body').addClass('overflow-hidden');
}


$("#btn-checkAnswers").click(function() {
    $('html,body').animate({
        scrollTop: $("#answers").offset().top},
        'slow');
});


function secondsToMinutes(time){
    return Math.floor(time / 60)+' Min:'+Math.floor(time % 60) +" Secs";
}

function reTestFunc(){
 $.ajax({
         url   : '/api/v1/remove-cache/',
         type  : 'post',
         data  : {'test_id':'{{object.id}}' }, // data to be submitted
         success: function(response){
         window.location.href = '/practice-tests/{{object.slug}}-test/'
         }
    });
}

	$(".input-effect input").focusout(function(){
			if($(this).val() != ""){
				$(this).addClass("has-content");
			}else{
				$(this).removeClass("has-content");
			}
		})



$("#leadCreationForm").submit(function(e){
flag=$('#leadCreationForm').valid();
if(flag){
    var form = $(this);
    $.ajax({
         url   : '/lead/lead-management/',
         type  : 'post',
         data  : form.serialize(), // data to be submitted
         success: function(response){
         }
    });
    testSession({'lead_created':true});
    getCoptions();
     $("#check_results").removeClass('open');

    <!--$('#leadCreationModal').modal('hide');-->
    return false;
}
 });




</script>

{% endblock js_section %}


{% block johukum %}
{% endblock johukum %}
{% block zendesk %}
{% endblock zendesk %}