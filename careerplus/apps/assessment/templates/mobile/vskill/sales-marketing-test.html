{% extends "mobile/basic/base.html" %}
{% load static compress %}
{% load static thumbnail compress %}
{% block title %}Shine learning{% endblock %}
{% block css_section %}
{{ block.super }}
{% compress css %}
<link type="text/scss" href="{% static 'shinelearn/css/mobile/vskill/practice_tests.scss' %}" rel="stylesheet">
<link type="text/scss" href="{% static 'shinelearn/css/mobile/common/slick.scss' %}" rel="stylesheet">
<link type="text/css" href="{% static 'shinelearn/css/common/mobile/typeaheadjs.css' %}" rel="stylesheet">
{% endcompress %}
{% endblock css_section %}
{% block canonical_url %}
<link rel="canonical" href="//{{ SITE_DOMAIN }}/">
{% endblock canonical_url %}
{% block django_meta %}
{% include 'meta/meta.html' %}
{% endblock django_meta %}
{% block header %}
{% endblock header %}
{% block container %}
<div class="body-wrapper practice-test ">
    <div class="practice-test-inside"></div>

    <div class="back"></div>

<h1>{{Category.heading}}</h1>
        {% block breadcrumb %}
         <div class="bread-crums">
            {% for bread in breadcrumbs %}
            {% if bread.url %}
            <a href='{{bread.url}}'>{{bread.name}} -</a>
            {% else %}
            <a>{{bread.name}}</a>
            {% endif %}
            {% endfor %}
         </div>
         {% endblock breadcrumb %}

    <div class="search">
        <div class="searchbox" id="bloodhound">
            <input type="text"  class="typeahead form-control" name="" placeholder="Search popular tests"><span class="icon_search"></span>
        </div>
    </div>

    <div class="popular_test" id="funcDiv">
                       {% for cat in category|slice:":8"  %}

        <div class="popular_test_inside category">
            <a href="{% url 'assessment:vskill-subcategory' slug=cat.slug %}">
                <span class="border border{{forloop.counter0}}"></span>
                <span class="name">{{cat.heading}}</span>
                <span class="test">{{cat.get_assessment_test}}
                    {% if cat.get_assessment_test < 1 %}Test {% else %}Tests{% endif %}</span>
            </a>
        </div>
                       {% endfor %}

    </div>
        {%if category.count > 8 %}
        <button class="load_more_button" id="loadmorebtn" onclick="loadmore();">Load more</button>
      {% endif %}

    </div>
{% endblock container %}
{% block js_section %}
{{block.super}}
   <script type="text/javascript">
   var page_number= 2;
   function loadmore(){
            page_number = page_number+1;
             element = document.getElementById('funcDiv');
           $.ajax({
               url: '/api/get-category-level-products',
               type: "GET",
               data : {'page_size' : 4,'test_category_id':'{{Category.id}}' ,'page':page_number,'only_test_level3category':true},
               dataType: 'json',
               success: function(json) {
               if (json.next == null){
                 $('#loadmorebtn').hide();
               }
               for (fa in json.results){
                element.innerHTML=
                element.innerHTML + `<div class="popular_test_inside category">
                <a href = "/practice-tests/${json.results[fa].slug}/sub/"

                <span class="border border{{forloop.counter0}}"></span>
                <span class="name">${json.results[fa].heading}</span>
                <span class="test">${json.results[fa].assessment_test}
                ${json.results[fa].assessment_test < 1 ? 'Test':'Tests'}
                    </span>
            </a>
        </div>`
               }
               },
               error: function(xhr, ajaxOptions, thrownError) {
               if(xhr.status == 404){
                     alert("No more Categories to show ");
                     $('#loadmorebtn').hide();
                     }
                     else{

                   alert("Something went wrong. Try again later");
                   }
               }
           });
   }
   </script>
<script src="{% static 'shinelearn/js/assessment/assessment_search.js' %}"></script>

{% endblock js_section %}
{% block johukum %}
{% endblock johukum %}
{% block zendesk %}
{% endblock zendesk %}