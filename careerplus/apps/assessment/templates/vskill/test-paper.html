{% extends "basic/base1.html" %}
{% load static meta thumbnail compress %}
{% block title %}Job Assistance Services | Online Courses - Shine Learning {% endblock title %}
{% block canonical_url %}
<link rel="canonical" href="//{{ SITE_DOMAIN }}/">
<link rel="alternate" href="//{{ MOBILE_SITE_DOMAIN }}/">
{% endblock canonical_url %}
{% block django_meta %}
{% include 'meta/meta.html' %}
{% endblock django_meta %}
{% block css_section %}
{{block.super}}
{% compress css %}
<link type="text/scss" charset="utf-8" href="{% static 'shinelearn/css/practice-skill/practice-skill.scss' %}"
      rel="stylesheet">
<link type="text/css" href="{% static 'shinelearn/css/common/inputTags.css' %}" rel="stylesheet">
{% endcompress %}
<style>
   .inactive{
      display:None;
   }
   .dirt{
      background:green !important;
      color:white !important;
   }
   .skipped{
      background:red !important;
      color:white !important;
   }




</style>
{% endblock css_section %}
{% block main_container %}
<div class="practice-skill__wrap-inner">
    <div class="right_base"></div>
    <div class="container">
        {% block breadcrumb %}
        <ol class="breadcrumb  black " itemscope="" itemtype="http://schema.org/BreadcrumbList">
            {% for bread in breadcrumbs %}
            {% if bread.url %}
            <li><a href='{{bread.url}}'>{{bread.name}}</a></li>
            {% else %}
            <li class="active">{{bread.name}}</li>
            {% endif %}
            {% endfor %}
        </ol>
        {% endblock breadcrumb %}

        <div class="row">
            <div class="col-sm-12 col-lg-12 col-md-12">
                <h1>Search Engine Optimisation Test</h1>
            </div>
            <!-- tests starts -->
            <div class="col-sm-9 mt-30">
                <div class="test-paper-box white-box">
                    <div class="pagination-box flexbox">
                        <div class="paper-pagination">
                            {% for quest in questions_list %}
                            <span class="marked" id="markedquestion-{{forloop.counter}}"
                                  data-attr-value="{{forloop.counter}}">{{forloop.counter}}</span>
                            {% endfor %}
                        </div>
                        <div class="pagination-more">
                            <i class="pagination-down"></i>
                        </div>
                    </div>
                    <!-- paper starts -->
                    {% for quest in questions_list %}
                    <div class="test-paper {% if forloop.counter == 1 %} actived {% else %}inactive{% endif %}"
                         id="question-{{forloop.counter}}">


                        <div class="flexbox">
                            <h3>{{forloop.counter}} {{quest.question_text}} </h3>
                            <strong>{{forloop.counter}} of {{questions_list.count}}</strong>
                        </div>
                        <ul class="test-paper__question">
                            {% for ans in quest.question_options %}
                            <li>
                                <label class="custom-radio">{{ans.option}}
                                    <input type="radio" id="{{ans.option_id}}" name="radio">
                                    <span class="checkmark"></span>
                                </label>
                            </li>

                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                    <!-- paper end -->
                    <div class="flexbox ml-20">
                        <button class="blue_btn mr-20" id="nextQuestionBtn" onclick="nextquestion('1');">Next question&nbsp;
                            &rsaquo;
                        </button>
                        <button class="white_btn" onclick="skipQuestion()" ;>Skip</button>
                        <span class="flexbox align-self-mla mr-20"><button class="white_btn" onclick="submitTest();">End test</button></span>
                    </div>
                </div>
            </div>

            <!-- right section starts -->
            <div class="col-sm-3 mt-30" >
                <div class="white-box mb-20 bdr-bottom">
                    <div class="time flexbox align-items-center" id="timeTest" >
                        <strong>Time left</strong>
                        <span class="time-dot" id="testRemanMinutes" style="color:red;">--<span>minutes</span></span>
                        <span id="testRemanSeconds" style="color:red;">--<span>seconds</span></span>
                    </div>
                </div>

                <!------- Add to cart   ----->

                <div class="white-box bdr-bottom">
                    <div class="test-benefits benefits-bg">
               <span class="pad-15">
                  <h3><a href="#">Advanced Search Engine Optimisation Test</a></h3>
                  <h4 class="mt-0" id="test-price">Rs. 699</h4>
                  <strike>Rs. 999</strike>
                  <span class="grey-border mt-15 mb-15"></span>
                  <strong>Benefits</strong>
                  <p>500+ questions</p>
                  <p>Real exam & Practice environment</p>
                  <p>Answers & Detailed Explanations</p>
                  <span class="flexbox align-items-center mt-20">
                     <button class="yellow_btn" onclick="addToCart('{{object.vendor.id}}','{{object.category.id}}')">Add to cart</button>
                  </span>
               </span>
                    </div>
                </div>
                <!----------- end add to cart  ------------>
            </div>
        </div>
    </div>
</div>
</div>



<!-- Modal  for submit permission-->
<div id="submitPermissionModal" class="modal fade" role="dialog" aria-labelledby="ModalCenterTitled" aria-hidden="true">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">ATTENTION</h4>
      </div>
      <div class="modal-body">
        <p>Are You Sure, You Want To Submit The Test ?</p>
      </div>
      <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn btn-default" >No</button>
        <button type="button" class="btn btn-default" onclick="submitTestFinal();">Yes</button>

      </div>
    </div>

  </div>
</div>


{% endblock main_container %}
{% block js_section %}
{{block.super}}
<script src="{% static 'shinelearn/js/assessment/take_test.js' %}"></script>
<script>
$('#timeTest').ready(function() {
getProductDetail('{{object.vendor.id}}','{{object.category.id}}');
        $.ajax({
         url   : '/api/v1/get-set-time/?test_id={{object.id}}&duration={{object.duration}}',
         type  : 'get',
         success: function(response){
         startTestTime = new Date(response.testStartTime);
         endTestTime = new Date(response.testStartTime);
        endTestTime.setSeconds(endTestTime.getSeconds() + {{object.duration}});
        if (endTestTime > new Date()){
           startTimer(Math.floor((endTestTime.getTime() - new Date().getTime())/1000));
        }
        else{
           window.location.href = '/practice-tests/{{object.slug}}/result/';
        }
            return false;
         }
    });

});
</script>
<script type="text/javascript">
let page_number = 2, questionAttempt = {},
maxCounter = parseInt({{questions_list.count}}),
activeTab = 1,
tKey = 'Test-' + '{{object.id}}',myStorage = window.localStorage,
sec =0,testSec = 0,testMin =0,interval=0,testSubmission= false,
delAns = {% if delete_ans %}true{% else %}false{% endif %},
startTestTime = NaN,endTestTime = NaN,timeout =NaN ;

$(document).ready(function() {

    // removes local storage
    if (delAns) {
        myStorage.removeItem(tKey);
    }
    else {
        questionAttempt = JSON.parse(myStorage.getItem(tKey));
        if (questionAttempt != null) {
        testSubmission = questionAttempt['testSubmission' + {{object.id}}];

        if (testSubmission == true) {

            window.location.href = '/practice-tests/{{object.slug}}/result/';
        }

            for (var id in Object.keys(questionAttempt)) {
                if (Object.values(questionAttempt)[id] != "") {
                    $('#' + Object.values(questionAttempt)[id]).click();
                    $('#marked' + Object.keys(questionAttempt)[id]).removeClass();
                    $('#marked' + Object.keys(questionAttempt)[id]).addClass('dirt');
                }
            }
            $('#' + questionAttempt['question-' + activeTab]).prop("checked", true);

        } else {
            questionAttempt = {};
        }
    }
    delAns =false;

});

function loadmore() {
    page_number = page_number + 1;
    element = document.getElementById('funcDiv');
    $.ajax({
        url: '/api/get-category-level-products',
        type: "GET",
        data: {
            'tl': 2,
            'page_size': 4,
            'page': page_number
        },
        dataType: 'json',
        success: function(json) {
            if (json.next == null) {
                $('#loadmorebtn').hide();
            }
            for (fa in json.results) {
                element.innerHTML = element.innerHTML + '<div class="functional_test_inside border-' + fa + '"><a href="#"><span class="sales"></span>' + json.results[fa].heading + '</a></div>'

            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            if (xhr.status == 404) {
                alert("No more Categories to show ");
                $('#loadmorebtn').hide();
            } else {
                alert("Something went wrong. Try again later");
            }
        }
    });
}

$('.marked').click(function() {
    let value = parseInt(this.dataset.attrValue);
    activeTab = value;
    if (questionAttempt['question-' + activeTab]) {
        $('#' + questionAttempt['question-' + activeTab]).prop("checked", true);
    }
    $('.test-paper').addClass('inactive');
    $('.test-paper').removeClass('actived');
    $('#question-' + value).removeClass('inactive');
    $('#question-' + value).addClass('actived');
    if (activeTab >= maxCounter) {
        $('#nextQuestionBtn').hide();
    } else {
        $('#nextQuestionBtn').show();
    }
});


function nextquestion(number) {
    if (activeTab < maxCounter && number > 0) {
        $('#question-' + activeTab).removeClass("actived");
        $('.test-paper').addClass('inactive');

        activeTab = parseInt(activeTab) + parseInt(number);
        if (questionAttempt['question-' + activeTab]) {
            $('#' + questionAttempt['question-' + activeTab]).prop("checked", true);
        }
        $('#question-' + activeTab).removeClass('inactive');
        $('#question-' + activeTab).addClass('actived');

        if (activeTab >= maxCounter) {
        $('#nextQuestionBtn').hide();
        } else {
        $('#nextQuestionBtn').show();
        }
    }
}

$('input[name="radio"]').on("click", function(e) {
    let quest_id = $(e.target).closest(".test-paper")[0].id;
    $('#marked' + quest_id).removeClass();
    $('#marked' + quest_id).addClass('dirt');
    questionAttempt[quest_id] = e.target.id;
    myStorage.setItem(tKey, JSON.stringify(questionAttempt));
});

function skipQuestion() {
    $('#markedquestion-' + activeTab).addClass('skipped');
    let quest_id = 'question-' + activeTab;
    $('#' + questionAttempt[quest_id]).prop("checked", false);
    delete questionAttempt[quest_id];
    nextquestion(1);
}

function startTimer(duration,) {
    var timer = duration, minutes, seconds;
     interval = setInterval(function () {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        $('#testRemanMinutes').text(minutes);
        $('#testRemanSeconds').text(seconds);

        if(--timer<=0){
            console.log('time out')
        }

       if (minutes <= 0 && seconds <= 0) {
            clearInterval(interval);
              $('#testRemanMinutes').text("Time");
            $('#testRemanSeconds').text("Out");
            timeout = true;
            submitTestFinal();
        }
    }, 1000);
    $('#timeTest').show();

}

<!--$("#leadCreationForm").submit(function(e){-->
    <!--var form = $(this);-->
    <!--$.ajax({-->
         <!--url   : '/lead/lead-management/',-->
         <!--type  : 'post',-->
         <!--data  : form.serialize(), // data to be submitted-->
         <!--success: function(response){-->
           <!--window.location.href = '/practice-tests/{{object.slug}}/result/';-->
         <!--}-->
    <!--});-->
    <!--return false;-->
    <!--testSession({'lead_create':true});-->

 <!--});-->

function submitTest(){
     $("#submitPermissionModal").modal('show');
}




function submitTestFinal(){
      if (timeout){
            testSession({'timeout':true,'test_id':{{object.id}} });
      }
      else{
            testSession({'submit':true,'test_id':{{object.id}} });
      }
      submitTime = new Date().getTime();
      $("#submitPermissionModal").modal('hide');
      clearInterval(interval);
      testSubmission = true;
      questionAttempt['testSubmission{{object.id}}'] = testSubmission;
      questionAttempt['testTime'+{{object.id}}] = Math.floor((submitTime - startTestTime.getTime())/1000) ;
      myStorage.setItem(tKey, JSON.stringify(questionAttempt));
      window.location.href = '/practice-tests/{{object.slug}}/result/';

}


</script>
{% endblock js_section %}
{% block johukum %}
{% endblock johukum %}
{% block zendesk %}
{% endblock zendesk %}