{% if order_list %}
<ul class="table-data panel-group mt-0" id="accordion" role="tablist" aria-multiselectable="true">
<li class="data-heading">
  <datalist class="col-sm-3">
    Order ID
  </datalist>
  <datalist class="col-sm-2">
    Placed on
  </datalist>
  <datalist class="col-sm-1">
    Status
  </datalist>
  <datalist class="col-sm-2">
    No of items
  </datalist>
  <datalist class="col-sm-3 col-md-2">
    Total amount
  </datalist>
  <datalist class="col-sm-1">
  </datalist>
</li>

{% for data in order_list %}
    {% with order=data.order orderitems=data.orderitems item_count=data.item_count product_type_flow=data.product_type_flow product_id=data.product_id %}
        <li>
          <div class="panel-titles" role="tab" id="heading{{order.id}}">
            <div class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{{order.id}}" aria-expanded="false" aria-controls="collapse{{order.id}}">
              <datalist class="col-sm-3">
                <strong>{{order.number}}</strong>
              </datalist>
              <datalist class="col-sm-2">
                {{order.date_placed.date}}
              </datalist>
              <datalist class="col-sm-1">
                {% if order.status == 1 %}
                    Open
                {% elif order.status == 0 %}
                    Unpaid
                {% elif order.status == 3 %}
                    Closed
                {% elif order.status == 5%}
                    Cancelled
                {% endif %}

              </datalist>
              <datalist class="col-sm-2">
                <strong>{{item_count}} {% if item_count > 1 %}items{% else %}item{% endif %}</strong>
              </datalist>
              <datalist class="col-sm-2">
                <strong>{{order.get_currency}} {{order.total_incl_tax}}/-</strong>
              </datalist>
              <datalist class="col-sm-2">
               {% if product_type_flow == 16 %}
                    <form role="form" id="download-resume-form{{order.pk}}" method="POST" action="{% url "dashboard:dashboard-resumetemplatedownload" %}">
                      <div style="display:none">
                          <input type="hidden" name="csrfmiddlewaretoken"
                          value="{{csrf_token}}" />
                          <input type="hidden" name="order_pk" value="{{order.pk}}" />
                          <input type="hidden" name="product_id" value="{{product_id}}" />
                     </div>
                      <strong><a role="button" onclick="downloadOrderTemplate('{{order.pk}}');event.stopPropagation()">Download Template</a></strong>
                    </form>
                {% elif order.status == 1 or order.status == 3 %}
                    <form role="form" id="download-invoice-form{{order.pk}}" method="POST" action="{% url "dashboard:dashboard-invoicedownload" %}">
                      <div style="display:none">
                          <input type="hidden" name="csrfmiddlewaretoken"
                          value="{{csrf_token}}" />
                          <input type="hidden" name="order_pk" value="{{order.pk}}" />
                     </div>
                      <strong><a role="button" onclick="downloadOrderInvoice('{{order.pk}}');event.stopPropagation()" id="download-order-invoice{{order.pk}}">Download invoice</a></strong>
                    </form>
                {% elif order.status == 0 %}
                      <strong><a role="button" onclick="openCancelModal({{order.pk}});event.stopPropagation()">Cancel Order</a></strong>
                {% endif %}
              </datalist>
            </div>
          </div>
          <ul id="collapse{{order.id}}" class="panel-collapse collapse {% if forloop.counter == 1 %}in{% endif %}" role="tabpanel" aria-labelledby="heading{{order.id}}">
            <li class="data-heading">
              <datalist class="col-sm-6">
                Item
              </datalist>
              <datalist class="col-sm-3">
                Item status
              </datalist>
            </li>
            {% for obj in orderitems %}
                <li>
                  <datalist class="col-sm-6">
                    {% if obj.product.type_flow == 12 and obj.parent %}
                        <strong><a>{{obj.parent.product.heading}}: {{obj.product.heading}}</a></strong>
                    {% else %}
                        <strong>
                          <a>
                            {{obj.product.get_name}}
                            {% if obj.product.get_exp_db %}
                             - {{obj.product.get_exp_db}}
                            {% endif %}
                            {% if obj.product.get_studymode_db %}
                             - {{obj.product.get_studymode_db}}
                            {% endif %}
                            {% if obj.product.get_coursetype_db %}
                             - {{obj.product.get_coursetype_db}}
                            {% endif %}
                            {% if obj.product.get_duration_in_day %}
                             - {{obj.product.get_duration_in_ddmmyy}}
                            {% endif %}
                          </a>
                      </strong>
                    {% endif %}
                  </datalist>
                  <datalist class="col-sm-3">
                    {% if obj.oi_status == 4 %}
                        Closed
                    {% elif obj.oi_status == 161 or obj.oi_status == 162 or obj.oi_status == 163 or obj.oi_status == 164 %}
                      {{obj.get_user_oi_status}}
                    {% elif order.status == 0 %}
                        Unpaid
                    {% elif order.status == 0 %}
                        Unpaid
                    {% elif order.status == 1 %}
                        Service in progress
                    {% elif order.status == 5%}
                        Cancelled

                    {% endif %}
                  </datalist>
                </li>
            {% endfor %}
          </ul>
        </li>
        {% if order.status == 0 %}
        <div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="mySmallModalLabel" id="cancelorder_div{{order.pk}}">
          <div class="modal-dialog modal-sm modal-custom" role="document">
            <div class="modal-content">
              <div class="register credit-modal">
                <div class="text-center">
                    <span class="modal-title text" id="myModalLabel">Do you wish to cancel the order?</span>
                </div>
                <div id="msg_for_user"></div>
                  <form role="form" id="download-invoice-form{{order.pk}}" method="POST" action="{% url "dashboard:cancel-order" %}">
                    <div style="display:none">
                      <input type="hidden" name="csrfmiddlewaretoken"
                          value="{{csrf_token}}" />
                      <input type="hidden" name="order_pk" value="{{order.pk}}" />
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                      <p> Any credit points redeemed against this order will be refunded back to your wallet shortly. These points will be valid for the next 10 days.</p>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 text-center">
                        <strong>
                          <button class="btn btn-primary reject "><a role="button" id="cancel-order-btn{{order.pk}}">Yes</a>
                        </strong></button>
                      </div>
                      <div class="col-md-6 text-center">
                        <strong>
                          <button type="button" class="btn btn-primary approve" data-dismiss="modal" aria-label="Close">
                            <a role="button" >No</a>
                          </button>
                        </strong>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
        </div>
     {% endif %}
    {% endwith %}
{% endfor %}

</ul>
{% endif %}
