{% extends "basic/base1.html" %}
{% load static meta compress %}

{% block title %}
  {% if meta.title %}{{ meta.title }}{% else %}{{prd_H1}}{% endif %}
{% endblock title %}
{% block canonical_url %}
  <link rel="canonical" href="https://{{ SITE_DOMAIN }}{{canonical_url}}">
{% endblock canonical_url %}

        {% block django_meta %}
            {% include 'meta/meta.html' %}
        {% endblock django_meta %}
 
{% block css_section %}
    {{block.super}}
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@8.14.0/dist/sweetalert2.min.css" rel="stylesheet" />

    {% compress css %}
    <link type="text/scss" href="{% static 'shinelearn/css/product/detail.scss' %}" rel="stylesheet">
    <link type="text/css" href="{% static 'shinelearn/css/skill/extra.css' %}" rel="stylesheet">
    {% endcompress %}
    <style>
      .js-error{
        float:left;
        color:red;
      }
    </style>
{% endblock css_section %}


{% block navigation %}
{% if not navigation %}
    <!-- navigation bar -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <a class="navbar-brand" href=""></a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            
            <ul class="nav navbar-nav navbar-right">
              <li class="dropdown have-query">
                <a href="tel:{{ggn_contact}}">Have a query? Call us at <strong>{{ggn_contact}}</strong></a>
              </li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
  </nav>
{% else %}
   {{block.super}}
{% endif %}

  {% endblock navigation %}


{% block main_container %}
    <div id="id-detail-body">
      <div id="loader" class="overlay-background" text-align: center;">
        <img aria-label="loader"  class="loader-position" src="{% static 'shinelearn/images/loader1.png' %}">
      </div>
      {{product_detail|safe}}
        <input id="skill" type="hidden" value=" {{skill}} ">
   </div>
{% if whatsapp_icon %}
{% for key,value in whatsapp_icon.items %}
{% if product.is_course and key == "product-course-number" %}
<a href="https://api.whatsapp.com/send?phone=91{{value}}&text=I need your help for {{product.heading}}"><div class="icon-whatsApp"></div></a>
{% elif product.is_writing and key == "product-service-number" or product.is_service and key == "product-service-number" %}
<a href="https://api.whatsapp.com/send?phone=91{{value}}&text=I need your help for {{product.heading}}"><div class="icon-whatsApp"></div></a>
{% endif %}
{% endfor %}
{% endif %}

{% if prd_vendor_slug == 'neo' %}
  <!-- Facebook Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '379551866029481');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=379551866029481&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Facebook Pixel Code -->
  
  
   
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-N6D4P34');</script>
  <!-- End Google Tag Manager -->

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6D4P34"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  {% endif %}
{% endblock main_container %}


{% block js_section %}
    {{block.super}}
    <script>
    var shineApiUrl = "{{shine_api_url}}"
      var trackingProductId = "{{tracking_product_id}}"
      var productTrackingMappingId = "{{product_tracking_mapping_id}}"
      var trackingId = "{{tracking_id}}"
      var productId ="{{product_id}}"
      var triggerPoint = "{{trigger_point}}"
      var uId = "{{u_id}}"
      var position = "{{position}}"
      var utmCampaign = "{{utm_campaign}}"
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8.14.0/dist/sweetalert2.all.min.js"></script>

    {% compress js %}
    <script src="{% static 'shinelearn/js/common/plugin.activeOnScroll.js' %}"></script>
    <script src="{% static 'shinelearn/js/shop/commonDetails.js' %}"></script>
    
    <script src="{% static 'shinelearn/js/cart/cart.js' %}"></script>
    <script src="{% static 'shinelearn/js/shop/detail.js' %}"></script>
    <script src="{% static 'shinelearn/js/common/scroller.js' %}" type="text/javascript"></script>
    <script src="{% static 'shinelearn/js/users/login.js' %}"></script>
    {% endcompress %}
    
<script type="text/javascript">
var authen=false;
var prod_id = {{product.id}};
var skill =document.getElementById("skill").value;
var display_info = " ";

function toggle_review(text_to_display) {
	display_info = text_to_display;
	var review_display = $('#review').children('h2').text();
	if (review_display == " ") {

		$('#review').children('h2').text('Reviews');
		$('#review').children('a').text(text_to_display);
		$('#review').children('a').css({
			'right': '15px',
			'left': '',
			'margin-top': '0px'
		});
		if ($('#collapseExampleform').hasClass('in')) {
			$('#review').children('a').before('<input type="button" class="review-close" id="close" onclick="close_review()" value="X"></input>');
		}
	} else {
		$('#review').children('h2').text($('#review').children('a').text());
		$('#review').children('a').before('<input type="button" id="close" class="review-close" onclick="close_review()" value="X"></input>');
		$('#review').children('a').css({
			'display': 'none'
		});
	}
}

function close_review() {
	$('#close').remove();
	$('#review').children('h2').text("Reviews");
	$('#review').children('a').css({
		'display': 'block'
	});
	$('#collapseExampleform').removeClass('in');
	$('#collapseExampleform').css({
		'height': ''
	});
}

$(document).ready(function() {
{% if request.session.candidate_id %}
    authen=true;
{%else%}
    authen =false;
{%endif%}
 ajax_call(authen,prod_id);
});



</script>
{% if prd_vendor_slug == 'neo' %}

<script>
  $(document).on('click', '#id_callback_neo', function() {
    $('#callback_form').validate({
      rules:{
        name:{
            maxlength: 80,
        },
        number:{
            required: true,
            number: true,
            indiaMobile: true,
            // minlength: 4,
            maxlength: 10
        },
        msg:{
          required: true,
          maxlength: 500,
        },
        email:{
          required: true,
          maxlength: 100,
          email: true,
        }
      },
      messages:{
        name:{
          required: "Name is Mandatory.",
          maxlength: "Maximum 80 characters.",
        },
        email:{
          required: "Email is Mandatory.",
          maxlength: "Please enter at most 100 characters.",
          email: "Please enter valid email"
        },
        number:{
          required: "Mobile Number is Mandatory",
          number: "Enter only number",
          indiaMobile: "Please enter 10 digits only",
          maxlength: "Please enter 10 digits",
          // minlength: "Please enter atleast 4 digits"
        },
      },
      highlight:function(element, errorClass) {
          $(element).closest('.form-group').addClass('error');
      },
      unhighlight:function(element, errorClass) {
          $(element).closest('.form-group').removeClass('error');
          $(element).siblings('.error-txt').html('');
      },
      errorPlacement: function(error, element){
          $(element).siblings('.error-txt').html(error.text());
      },
      ignore : '',
      submitHandler: function(form){
        // ga code
        var path = window.location.pathname,
            action = '';
        if (path.indexOf('/course/') > -1) {
          action = 'Course Enquiry';
        } else if (path.indexOf('/services/') > -1) {
          action = 'Service Enquiry';
        }
        MyGA.SendEvent('QueryForm', 'Form Interactions', action, 'success');
        //form.submit();
        var formData = $(form).serialize();
        $.ajax({
          url : "/lead/lead-management/",
          type: "POST",
          data : formData,
          success: function(data, textStatus, jqXHR)
          {
            
          },
          error: function (jqXHR, textStatus, errorThrown)
          {
            alert('Oops Some error has occured. Kindly try again later.');
            $("#detailpage").modal('toggle');
            form.reset();
          }
        });
      }
    });

    var flag = $('#callback_form').valid();
    if (flag){
      $('#callback_form').submit();}
  });
  function load_test(email, name, country_code, mobile_no){
      global_email = email
      var iframe = document.getElementById('iframe'),
      iframeWin = iframe.contentWindow || iframe,
      iframeDoc = iframe.contentDocument || iframeWin.document;
      var html =
        '<html>' + 
        '<head>' +
        '<meta content="width=device-width,  initial-scale=1"  name="viewport" />' +
        '<scr' + 'ipt src="https://etest.dyned.com/neowidget.min.js"></scr' + 'ipt>' +
        '</head>' +
        '<body>'+
        '<neo id="widgetbyneo"data-neo-email="'+ email +'"data-neo-mode="pt" data-neo-token="xRm7FoiyQ221ZL7MV07zEOtcF3xrPcCTXYKmAnA5ylPtFWYCWJS6XqgXoHFsmuPR"data-neo-dial-code="'+country_code+'"data-neo-phone-number="'+mobile_no+'"data-neo-fullname="'+name+'"data-neo-autostart="false">' +
        '</body>' + 
        '</html>';

        iframe.srcdoc = html;
    }

function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}

function getCookie(name) {
  var cookieValue = null;
  if (document.cookie && document.cookie !== '') {
      var cookies = document.cookie.split(';');
      for (var i = 0; i < cookies.length; i++) {
          var cookie = jQuery.trim(cookies[i]);
          // Does this cookie string begin with the name we want?
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
          }
      }
  }
  return cookieValue;
}
function get_create_profile(email, name, country_code, mobile) {


    var data = {
        'email': email,
        'mobile_no': country_code + mobile ,
        'name': name,
    }

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
              xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
          }
        }
    });

    $.post(`/api/v1/create_practice_test_info/`,data,function(response,status,responseJSON){
      if(responseJSON.status == '201' || responseJSON.status =='200'){
        check_for_load_test(response)
      } 
      else {
       
        $('#neo-test-modal').modal('hide')
        Swal.fire(
          'Oops...',
          'Site is under maintenance! Please try after some time',
          'warning'
        )
      }
        
    }).fail((error)=>{
      $('#neo-test-modal').modal('hide')
      Swal.fire(
          'Oops...',
          'Check your internet connectivity',
          'warning'
        )
    })
}

function check_for_load_test(data){
    if('has_completed' in data){
      if(data['has_completed']){
        //pass
        $(".neo-enroll-button").each(function(){
          $(this).attr("data-neotest", '0')
          $(this).attr('id', 'add-to-cart');
        });

       
        $('#neo-test-modal').modal('hide')
        $("#cefr_level").text(data['cefr_level'])
        let title = 'Hey, I got ' + data['cefr_level'] +'. What about you?'
        let description = 'I got CEFR ' + data['cefr_level'] + ' in this internationally recognized English Test. Check yours now'
        let url = window.location.href + "?title=" + title + "&description=" + description + "&level=" + data['cefr_level'] + '&iframe=true&utm_campaign=scoreshare'
        
        var attr = $("#id_share").attr('data-href');

        if (attr == undefined) {
            $("#id_share").attr('data-href', encodeURI(url))
        }
        $("#cefr_level_box").show()
        $("#row_neo").remove()
      }
      else{
        $('#iframe').show();
        $("#neo-test-form").hide();
        load_test(email, name, country_code, mobile_no);
        $('#neo-test-modal').modal({
            backdrop: 'static',
            keyboard: false
        });
      }
    }
}

function update_test_info(email){
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
              xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
          }
        }
    });
    $.ajax({
        url: "/api/v1/update_practice_info/?email="+ encodeURIComponent(email),
        type: "GET",
        success: function(data, textStatus, jqXHR) {
          if(data['status'] == 'done'){
            $(".neo-enroll-button").each(function(){
              $(this).attr("data-neotest", '0')
              $(this).attr('id', 'add-to-cart');
            })
              var ifrm = document.getElementById('iframe');
              var doc = ifrm.contentDocument? ifrm.contentDocument: ifrm.contentWindow.document;
              btn = $(doc).find('#neobackhomebutton');
              btn.text('Enroll Now');
              btn.css('color', 'black')
              btn.css('background', '#ffcf26')
              $("#cefr_level").text(data['result']['pt_level'])
              let title = 'Hey, I got ' + data['result']['pt_level'] +'. What about you?'
              let description = 'I got CEFR ' + data['result']['pt_level'] + ' in this internationally recognized English Test. Check yours now'
              let url = window.location.href + "?title=" + title + "&description=" + description + "&level=" + data['result']['pt_level'] + '&iframe=true&utm_campaign=scoreshare'
              var attr = $("#id_share").attr('data-href');

        if (attr == undefined) {
            $("#id_share").attr('data-href', encodeURI(url))
        }
              $("#cefr_level_box").show()
              $("#row_neo").remove()

          }
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.log(errorThrown)
        }
    });
}

function check_if_user_exists_for_another_vendor(email) {
  $.ajax({
      url: "/api/v1/update_practice_info/?email="+ encodeURIComponent(email),
      type: "GET",
      success: function(data, textStatus, jqXHR) {
        // do nothing if exists
      },
      error: function(jqXHR, textStatus, errorThrown) {
      $('#neo-test-modal').modal('hide');
      $("#neo-test-form").show();
      $('#iframe').hide();
      alert('This email already registered with another Neo Partner');
      }
  });
}


jQuery.validator.addMethod("customEmail", function(value, element) {
    var regex = /^([a-zA-Z0-9]+[a-zA-Z0-9_.+-]+)+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    return regex.test(value);
}, "Enter valid email");

{% if not request.session.candidate_id %}
 $('#neo-test-form').validate({
      submitHandler:function (form) {
          var $inputs = $('#neo-test-form :input');
          var values = {};
          $inputs.each(function() {
              values[this.name] = $(this).val();
          });
          name = values['name'];
          email = values['email'];
          country_code = values['country_code'];
          mobile_no = values['mobile'];
          get_create_profile(email, name, country_code, mobile_no);
          $('#callback_form').find('input[name="name"]').val(name)
          $('#callback_form').find('input[name="email"]').val(email)
          $('#callback_form').find('input[name="number"]').val(mobile_no)
          $('#id_callback_neo').trigger('click')

      },
      rules:{
          mobile:{
              required:true,
              number:true,
              minlength:10,
              maxlength:10,
          },
          email:{
              email:true,
              required:true,
              customEmail: true

          },
          name:{
              required:true,
              lettersonly:true,

          },
      },
      messages:{
          mobile:{
             required:"Field is required",
             number: "Please enter valid number only"
          },
          email:{
              required:"Field is required"
          },
          name:{
              required:"Field is required"
          },

      },
      highlight:function(element, errorClass) {
        $(element).closest('.form-group').addClass('error');
      },
      unhighlight:function(element, errorClass) {
        $(element).closest('.form-group').removeClass('error');
        $(element).siblings('.js-error').html("");
      },
      errorPlacement: function(error, element){
        $(element).siblings('.js-error').html(error.text());
      } 

    });
{% endif %}


$('#take-test_button').click(function(){
  
    {% if request.session.candidate_id %}
        let email = "{{ request.session.email }}";
        let name = "{{request.session.full_name}}";
        let country_code = "{{request.session.country_code}}";
        let mobile_no = "{{request.session.mobile_no}}";
        get_create_profile(email, name, country_code, mobile_no)

    {% else %}
        $("#neo-test-form").show();
        $('#neo-test-modal').modal({
            backdrop: 'static',
            keyboard: false
        });
    {% endif %}
  });

$('.neo-enroll-button').click(function(){
    neotest = $(this).attr("data-neotest")
    if(neotest=='1') {
        $('#neo-info-modal').modal({
            backdrop: 'static',
            keyboard: false
        });
    }
})


$('#neo-test-modal').on('hidden.bs.modal', function () {
  $("#neo-test-form").hide();
  $('#iframe').hide();
});


$("#modal-take-test-btn").click(function(){
    $('#neo-info-modal').modal('hide');
    $('#take-test_button').trigger('click');
})

// attache event handler to neo test submit button
$('iframe').load(function(){
    var ifrm = document.getElementById('iframe');
    var doc = ifrm.contentDocument? ifrm.contentDocument: ifrm.contentWindow.document;
 
    $(doc).on('click', '#neookbutton', function() {
        update_test_info(global_email);
    });

    $(doc).on('click', '#neoStartButton', function() {
    setTimeout(function(){
        check_if_user_exists_for_another_vendor(global_email)
        {% if request.session.candidate_id %}
        $('#callback_form').find('input[name="name"]').val(global_name)
        $('#callback_form').find('input[name="email"]').val(global_email)
        $('#callback_form').find('input[name="number"]').val(global_mobile_no)
        $('#id_callback_neo').trigger('click')
        {% endif %}

    }, 1000) 

    });

    $(doc).on('click', "#neobackhomebutton", function(){
      $('#add-to-cart').trigger('click');
    })
});

$("#id_share").click(function(){

  let url = $("#id_share").attr('data-href')
  FB.ui({
    method: 'share',
    href: url,
  }, function(response){});
})


{% if request.session.candidate_id %}
  let email = "{{ request.session.email }}";
  let name = "{{request.session.full_name}}";
  let country_code = "{{request.session.country_code}}";
  let mobile_no = "{{request.session.mobile_no}}";
  var global_name = "{{request.session.full_name}}";
  var global_mobile_no = "{{request.session.mobile_no}}";
  get_create_profile(email, name, country_code, mobile_no)

{% else %}
window.location.href.includes('&iframe')
curr_url = window.location.href
if(curr_url.includes('?iframe=')||curr_url.includes('&iframe=')){
  $("#neo-test-form").show();
  $('#neo-test-modal').modal({
      backdrop: 'static',
      keyboard: false
  });
}
{% endif %}




  </script>
{% endif %}
{% endblock js_section %}

  {% block zendesk %}
    {% if sqs.id in linkedin_resume_services %}
    {% else %}
      {{block.super}}
    {% endif %}
  {% endblock zendesk %}